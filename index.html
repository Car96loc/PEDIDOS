<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplicación de Pedidos de Comida</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el overlay del modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl de Tailwind */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl de Tailwind */
            position: relative;
            width: 90%;
            max-width: 400px;
        }
        .modal-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568; /* color gris */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs and Global Variables -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, doc, deleteDoc, updateDoc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"; // Added getDocs, setDoc

        // =====================================================================================
        // IMPORTANTE: Configuración de Firebase
        // ESTOS VALORES HAN SIDO REEMPLAZADOS CON TU CONFIGURACIÓN PROPORCIONADA
        // =====================================================================================
        window.firebaseConfig = {
            apiKey: "AIzaSyC3J1QvvxxoPzHmyPGMHAaYWMvUw1ZSmHk",
            authDomain: "app-comida-4613f.firebaseapp.com",
            projectId: "app-comida-4613f",
            storageBucket: "app-comida-4613f.firebasestorage.app",
            messagingSenderId: "217882832793",
            appId: "1:217882832793:web:73ea29892af026178d2d08"
        };

        // Si estás usando un entorno que proporciona un token de autenticación inicial, úsalo aquí.
        // De lo contrario, déjalo como null o una cadena vacía.
        window.initialAuthToken = null;

        // Define un ID de aplicación para Firestore. Usamos el projectId de tu firebaseConfig.
        window.appId = window.firebaseConfig.projectId;

        // Número de WhatsApp para el restaurante
        window.WHATSAPP_NUMBER = '5930962210284';

        // Contraseña de administrador
        window.ADMIN_PASSWORD = '9999';

        // Inicializar Firebase
        let app, db, auth;
        try {
            app = initializeApp(window.firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Asignar a window para que el componente React pueda acceder
            window.app = app;
            window.db = db;
            window.auth = auth;

        } catch (error) {
            console.error("Error al inicializar Firebase. Asegúrate de que tu firebaseConfig es correcta.", error);
        }

        // Función para manejar la autenticación inicial
        async function handleInitialAuth() {
            if (!auth) { // Si Firebase Auth no se inicializó correctamente
                console.error("Firebase Auth no está disponible. No se puede realizar la autenticación.");
                return;
            }

            if (window.initialAuthToken) {
                try {
                    await signInWithCustomToken(auth, window.initialAuthToken);
                    console.log("Sesión iniciada con token personalizado.");
                } catch (error) {
                    console.error("Error al iniciar sesión con token personalizado:", error);
                    console.log("Intentando inicio de sesión anónimo como respaldo.");
                    await signInAnonymously(auth); // Fallback a inicio de sesión anónimo
                }
            } else {
                try {
                    await signInAnonymously(auth);
                    console.log("Sesión iniciada de forma anónima.");
                } catch (error) {
                    console.error("Error al iniciar sesión de forma anónima:", error);
                    console.error("Asegúrate de que la autenticación anónima está habilitada en tu proyecto de Firebase.");
                }
            }
        }

        // Llama a la función de autenticación inicial
        handleInitialAuth();

        // Exportar para que Babel pueda acceder a ellos si es necesario (aunque se accede vía window)
        window.initializeApp = initializeApp;
        window.getAuth = getAuth;
        window.signInAnonymously = signInAnonymously;
        window.signInWithCustomToken = signInWithCustomToken;
        window.onAuthStateChanged = onAuthStateChanged;
        window.getFirestore = getFirestore;
        window.collection = collection;
        window.addDoc = addDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;
        window.doc = doc;
        window.deleteDoc = deleteDoc;
        window.updateDoc = updateDoc;
        window.getDocs = getDocs; // Export getDocs
        window.setDoc = setDoc;   // Export setDoc
    </script>

    <!-- React Component (using Babel for JSX) -->
    <script type="text/babel">
        // El componente React principal
        const App = () => {
            // Accede a las variables globales definidas en el script anterior
            const { db, auth, appId, WHATSAPP_NUMBER, ADMIN_PASSWORD } = window;

            const [userId, setUserId] = React.useState('');
            const [isAuthReady, setIsAuthReady] = React.useState(false);
            const [dishes, setDishes] = React.useState([]);
            const [cart, setCart] = React.useState([]);
            const [currentOrderId, setCurrentOrderId] = React.useState(null); // Nuevo estado para el ID de pedido corto

            // Admin Panel States
            const [adminPasswordInput, setAdminPasswordInput] = React.useState('');
            const [isLoggedInAsAdmin, setIsLoggedInAsAdmin] = React.useState(false); // Controls admin panel visibility
            const [adminLoginError, setAdminLoginError] = React.useState('');
            const [showAdminLoginModal, setShowAdminLoginModal] = React.useState(false); // New state for modal visibility

            const [dishName, setDishName] = React.useState('');
            const [dishDescription, setDishDescription] = React.useState('');
            const [dishPrice, setDishPrice] = React.useState('');
            const [dishImageUrl, setDishImageUrl] = React.useState('');
            const [dishIsVisible, setDishIsVisible] = React.useState(true); // New state for visibility
            const [editingDish, setEditingDish] = React.useState(null);

            // Genera un ID de pedido numérico corto (4 dígitos)
            const generateShortOrderId = () => {
                return Math.floor(Math.random() * 9000) + 1000; // Genera un número de 4 dígitos (entre 1000 y 9999)
            };

            // Set up authentication listener
            React.useEffect(() => {
                // Asegúrate de que 'auth' está disponible antes de intentar configurar el listener
                if (!auth) {
                    console.warn("Auth object is not available yet for onAuthStateChanged.");
                    return;
                }

                const unsubscribe = window.onAuthStateChanged(auth, (user) => {
                    if (user) {
                        setUserId(user.uid);
                        setIsAuthReady(true);
                        console.log("Estado de autenticación cambiado: Usuario autenticado con UID:", user.uid);
                    } else {
                        setUserId(''); // Limpiar userId si no hay usuario
                        setIsAuthReady(false); // No listo si no hay usuario
                        console.log("Estado de autenticación cambiado: Usuario no autenticado.");
                    }
                });
                return () => unsubscribe();
            }, [auth]); // Dependencia en 'auth'

            // Fetch dishes when db and auth are ready
            React.useEffect(() => {
                // Asegúrate de que 'db' y 'isAuthReady' están disponibles antes de intentar obtener datos
                if (!db || !isAuthReady) {
                    console.log("Base de datos no lista o autenticación no preparada para obtener platos.");
                    return;
                }

                const dishesCollectionRef = window.collection(db, `artifacts/${appId}/public/data/dishes`);
                const q = window.query(dishesCollectionRef);

                const unsubscribe = window.onSnapshot(q, (snapshot) => {
                    const fetchedDishes = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setDishes(fetchedDishes);
                    console.log("Platos obtenidos de Firestore:", fetchedDishes);
                }, (error) => {
                    console.error("Error al obtener los platos de Firestore:", error);
                });

                return () => unsubscribe();
            }, [db, isAuthReady, appId]); // Dependencias en 'db', 'isAuthReady', 'appId'

            // Admin Login Function
            const handleAdminLogin = () => {
                if (adminPasswordInput === ADMIN_PASSWORD) {
                    setIsLoggedInAsAdmin(true);
                    setAdminLoginError('');
                    setShowAdminLoginModal(false); // Close modal on successful login
                    console.log("Inicio de sesión de administrador exitoso.");
                } else {
                    setAdminLoginError('Contraseña incorrecta.');
                    console.warn("Intento de inicio de sesión de administrador fallido.");
                }
                setAdminPasswordInput(''); // Clear password input
            };

            // Admin Logout Function
            const handleAdminLogout = () => {
                setIsLoggedInAsAdmin(false);
                setAdminLoginError('');
                setShowAdminLoginModal(false); // Close modal on logout
                console.log("Sesión de administrador cerrada.");
            };

            // Admin Functions (only callable if isLoggedInAsAdmin is true)
            const addOrUpdateDish = async () => {
                if (!dishName || !dishDescription || !dishPrice || !dishImageUrl) {
                    alert('Por favor, rellena todos los campos del plato.');
                    return;
                }
                const parsedPrice = parseFloat(dishPrice);
                if (isNaN(parsedPrice) || parsedPrice <= 0) {
                    alert('Por favor, introduce un precio válido y mayor que cero.');
                    return;
                }

                if (db && isLoggedInAsAdmin) { // Check for admin login
                    try {
                        const dishesCollectionRef = window.collection(db, `artifacts/${appId}/public/data/dishes`);
                        if (editingDish) {
                            const dishDocRef = window.doc(db, `artifacts/${appId}/public/data/dishes`, editingDish.id);
                            await window.updateDoc(dishDocRef, {
                                name: dishName,
                                description: dishDescription,
                                price: parsedPrice,
                                imageUrl: dishImageUrl,
                                isVisible: dishIsVisible, // Save visibility status
                                updatedAt: Date.now()
                            });
                            setEditingDish(null);
                            console.log("Plato actualizado con éxito:", { name: dishName, price: parsedPrice, isVisible: dishIsVisible });
                        } else {
                            await window.addDoc(dishesCollectionRef, {
                                name: dishName,
                                description: dishDescription,
                                price: parsedPrice,
                                imageUrl: dishImageUrl,
                                isVisible: true, // Default to visible when adding new
                                createdAt: Date.now()
                            });
                            console.log("Plato añadido con éxito:", { name: dishName, price: parsedPrice, isVisible: true });
                        }
                        setDishName('');
                        setDishDescription('');
                        setDishPrice('');
                        setDishImageUrl('');
                        setDishIsVisible(true); // Reset to true for new dish
                    } catch (e) {
                        console.error("Error al añadir/actualizar documento en Firestore: ", e);
                        alert(`Error al guardar el plato: ${e.message}. Revisa la consola para más detalles y tus reglas de seguridad de Firestore.`);
                    }
                } else {
                    alert('No tienes permisos para realizar esta acción o la base de datos no está lista.');
                    console.warn("Intento fallido de añadir/actualizar plato: No hay permisos de administrador o DB no lista.");
                }
            };

            const startEditDish = (dish) => {
                if (isLoggedInAsAdmin) { // Check for admin login
                    setEditingDish(dish);
                    setDishName(dish.name);
                    setDishDescription(dish.description);
                    setDishPrice(dish.price.toString());
                    setDishImageUrl(dish.imageUrl);
                    setDishIsVisible(dish.isVisible !== undefined ? dish.isVisible : true); // Load visibility, default to true
                } else {
                    alert('No tienes permisos para realizar esta acción.');
                }
            };

            const toggleDishVisibility = async (dishId, currentVisibility) => {
                if (db && isLoggedInAsAdmin) {
                    try {
                        const dishDocRef = window.doc(db, `artifacts/${appId}/public/data/dishes`, dishId);
                        await window.updateDoc(dishDocRef, {
                            isVisible: !currentVisibility
                        });
                        console.log(`Visibilidad del plato ${dishId} cambiada a ${!currentVisibility}`);
                    } catch (e) {
                        console.error("Error al cambiar la visibilidad del plato:", e);
                        alert(`Error al cambiar la visibilidad: ${e.message}`);
                    }
                } else {
                    alert('No tienes permisos para realizar esta acción.');
                }
            };


            const deleteDish = async (id) => {
                if (db && isLoggedInAsAdmin) { // Check for admin login
                    // Se ha eliminado la confirmación de window.confirm para probar la funcionalidad de eliminación.
                    // Si la eliminación funciona, se puede implementar un modal de confirmación personalizado.
                    try {
                        const dishDocRef = window.doc(db, `artifacts/${appId}/public/data/dishes`, id);
                        await window.deleteDoc(dishDocRef);
                        console.log("Plato eliminado con éxito:", id);
                    } catch (e) {
                        console.error("Error al eliminar documento de Firestore: ", e);
                        alert(`Error al eliminar el plato: ${e.message}. Revisa la consola para más detalles y tus reglas de seguridad de Firestore.`);
                    }
                } else {
                    alert('No tienes permisos para realizar esta acción.');
                }
            };

            // Exportar base de datos
            const exportDatabase = async () => {
                if (db && isLoggedInAsAdmin) {
                    try {
                        const dishesCollectionRef = window.collection(db, `artifacts/${appId}/public/data/dishes`);
                        const querySnapshot = await window.getDocs(dishesCollectionRef);
                        const dataToExport = [];
                        querySnapshot.forEach((doc) => {
                            dataToExport.push({ id: doc.id, ...doc.data() });
                        });

                        const jsonString = JSON.stringify(dataToExport, null, 2);
                        const blob = new Blob([jsonString], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `platos_db_backup_${new Date().toISOString().slice(0,10)}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        alert('Base de datos de platos descargada con éxito.');
                        console.log("Base de datos exportada:", dataToExport);
                    } catch (e) {
                        console.error("Error al exportar la base de datos:", e);
                        alert(`Error al descargar la base de datos: ${e.message}. Revisa la consola.`);
                    }
                } else {
                    alert('No tienes permisos de administrador para exportar la base de datos.');
                }
            };

            // Importar base de datos
            const importDatabase = async (event) => {
                if (db && isLoggedInAsAdmin) {
                    const file = event.target.files[0];
                    if (!file) {
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const jsonContent = JSON.parse(e.target.result);

                            if (!Array.isArray(jsonContent)) {
                                alert('El archivo JSON no contiene un array de platos válido.');
                                return;
                            }

                            const confirmImport = window.confirm(
                                '¡ADVERTENCIA! Al importar la base de datos, los platos con IDs coincidentes se actualizarán, ' +
                                'y los nuevos se añadirán. Los platos existentes que no estén en el archivo JSON se conservarán. ' +
                                '¿Estás seguro de que quieres continuar?'
                            );

                            if (!confirmImport) {
                                return;
                            }

                            const uploadPromises = [];
                            for (const dish of jsonContent) {
                                // Usar setDoc para mantener el ID original si existe (actualizar), o addDoc si no (añadir nuevo)
                                const { id, ...data } = dish;
                                if (id) {
                                    // Si el plato tiene un ID, intenta actualizarlo
                                    uploadPromises.push(window.setDoc(window.doc(db, `artifacts/${appId}/public/data/dishes`, id), data, { merge: true })
                                        .catch(e => console.error(`Error al actualizar plato con ID ${id}:`, e)));
                                } else {
                                    // Si el plato no tiene ID, añádelo como uno nuevo
                                    uploadPromises.push(window.addDoc(window.collection(db, `artifacts/${appId}/public/data/dishes`), data)
                                        .catch(e => console.error("Error al añadir plato sin ID:", e)));
                                }
                            }
                            await Promise.all(uploadPromises);

                            alert('Base de datos de platos subida y fusionada con éxito.');
                            console.log("Base de datos importada y fusionada.");
                        } catch (error) {
                            console.error("Error al importar la base de datos:", error);
                            alert(`Error al subir la base de datos: ${error.message}. Asegúrate de que el archivo es un JSON válido.`);
                        }
                    };
                    reader.readAsText(file);
                } else {
                    alert('No tienes permisos de administrador para importar la base de datos.');
                }
            };


            // Client Functions
            const addToCart = (dish) => {
                // Si el carrito está vacío, genera un nuevo ID de pedido
                if (cart.length === 0 && !currentOrderId) {
                    setCurrentOrderId(generateShortOrderId());
                }

                setCart(prevCart => {
                    const existingItem = prevCart.find(item => item.id === dish.id);
                    if (existingItem) {
                        return prevCart.map(item =>
                            item.id === dish.id ? { ...item, quantity: item.quantity + 1 } : item
                        );
                    } else {
                        return [...prevCart, { ...dish, quantity: 1 }];
                    }
                });
                console.log("Plato añadido al carrito:", dish.name);
            };

            const removeFromCart = (dishId) => {
                setCart(prevCart => {
                    const existingItem = prevCart.find(item => item.id === dishId);
                    if (existingItem && existingItem.quantity > 1) {
                        console.log("Cantidad de plato reducida en el carrito:", existingItem.name);
                        return prevCart.map(item =>
                            item.id === dishId ? { ...item, quantity: item.quantity - 1 } : item
                        );
                    } else {
                        console.log("Plato eliminado del carrito:", existingItem ? existingItem.name : dishId);
                        return prevCart.filter(item => item.id !== dishId);
                    }
                });
            };

            const calculateCartTotal = () => {
                return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            };

            const sendOrderToWhatsApp = () => {
                if (cart.length === 0) {
                    alert('Tu carrito está vacío. Por favor, añade algunos platos antes de ordenar.');
                    return;
                }

                let message = `¡Hola! Me gustaría hacer un pedido:\n\n`;
                cart.forEach((item, index) => {
                    message += `${index + 1}. ${item.name} (x${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}\n`;
                });
                message += `\nTotal: $${calculateCartTotal().toFixed(2)}`;
                // Ahora el ID de Pedido va al final del mensaje y sin asteriscos
                message += `\n\nID de Pedido: ${currentOrderId || 'N/A'}`;


                const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                setCart([]); // Clear cart after sending order
                setCurrentOrderId(null); // Clear the short order ID
                console.log("Pedido enviado a WhatsApp y carrito vaciado.");
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-100 to-teal-200 p-4 font-sans flex items-center justify-center">
                    <div className="bg-white p-6 rounded-xl shadow-2xl w-full max-w-4xl relative"> {/* Added relative positioning here */}
                        {/* Título principal de la aplicación */}
                        <h1 className="text-4xl font-extrabold text-center text-teal-800 mb-8">
                            Aplicación de Pedidos de Comida
                        </h1>

                        {/* Botón visible para el panel de administración */}
                        {!isLoggedInAsAdmin && (
                            <button
                                onClick={() => setShowAdminLoginModal(true)}
                                className="absolute top-4 right-4 p-3 bg-gray-200 text-gray-700 rounded-full shadow-md hover:bg-gray-300 transition duration-200 z-50"
                                title="Panel de Administración"
                            >
                                {/* Icono de engranaje (settings) */}
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                                    <path fillRule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.3-.83-2.826.73-1.945 2.027a1.532 1.532 0 01-.58 2.246c-1.56.38-1.56 2.6 0 2.98a1.532 1.532 0 01.58 2.246c-.83 1.3.73 2.826 2.027 1.945a1.532 1.532 0 012.246.58c.38 1.56 2.6 1.56 2.98 0a1.532 1.532 0 012.286-.948c1.3.83 2.826-.73 1.945-2.027a1.532 1.532 0 01.58-2.246c1.56-.38 1.56-2.6 0-2.98a1.532 1.532 0 01-.58-2.246c.83-1.3-.73-2.826-2.027-1.945a1.532 1.532 0 01-2.246-.58zM10 11a1 1 0 100-2 1 1 0 000 2z" clipRule="evenodd" />
                                </svg>
                            </button>
                        )}


                        {/* User ID Display (still shown for internal reference in the app) */}
                        {userId && (
                            <div className="text-center text-sm text-gray-600 mb-4 p-2 bg-gray-100 rounded-lg">
                                <p>ID de Usuario (interno): <span className="font-mono text-teal-700 break-words">{userId}</span></p>
                            </div>
                        )}

                        {/* Admin Login Modal */}
                        {showAdminLoginModal && !isLoggedInAsAdmin && (
                            <div className="modal-overlay">
                                <div className="modal-content">
                                    <button className="modal-close-button" onClick={() => setShowAdminLoginModal(false)}>
                                        &times;
                                    </button>
                                    <h2 className="text-2xl font-bold text-blue-700 mb-4 text-center">Ingresar como Administrador</h2>
                                    <input
                                        type="password"
                                        placeholder="Contraseña de Administrador"
                                        className="p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 w-full mb-4"
                                        value={adminPasswordInput}
                                        onChange={(e) => setAdminPasswordInput(e.target.value)}
                                        onKeyPress={(e) => { if (e.key === 'Enter') handleAdminLogin(); }}
                                    />
                                    <button
                                        onClick={handleAdminLogin}
                                        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105"
                                    >
                                        Ingresar
                                    </button>
                                    {adminLoginError && (
                                        <p className="text-red-500 mt-2 text-center">{adminLoginError}</p>
                                    )}
                                </div>
                            </div>
                        )}

                        {isLoggedInAsAdmin ? (
                            // Admin Panel View
                            <div className="admin-panel">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-teal-700">Panel de Administración</h2>
                                    <button
                                        onClick={handleAdminLogout}
                                        className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300"
                                    >
                                        Cerrar Sesión (Admin)
                                    </button>
                                </div>
                                <div className="mb-8 p-6 bg-teal-50 rounded-lg shadow-inner">
                                    <h3 className="text-2xl font-bold text-teal-700 mb-4">
                                        {editingDish ? 'Editar Plato' : 'Añadir Nuevo Plato'}
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <input
                                            type="text"
                                            placeholder="Nombre del Plato"
                                            className="p-3 border border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-400 focus:border-transparent transition duration-200"
                                            value={dishName}
                                            onChange={(e) => setDishName(e.target.value)}
                                        />
                                        <input
                                            type="text"
                                            placeholder="Descripción del Plato"
                                            className="p-3 border border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-400 focus:border-transparent transition duration-200"
                                            value={dishDescription}
                                            onChange={(e) => setDishDescription(e.target.value)}
                                        />
                                        <input
                                            type="number"
                                            placeholder="Precio"
                                            className="p-3 border border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-400 focus:border-transparent transition duration-200"
                                            value={dishPrice}
                                            onChange={(e) => setDishPrice(e.target.value)}
                                        />
                                        <input
                                            type="text"
                                            placeholder="URL de la Imagen"
                                            className="p-3 border border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-400 focus:border-transparent transition duration-200"
                                            value={dishImageUrl}
                                            onChange={(e) => setDishImageUrl(e.target.value)}
                                        />
                                    </div>
                                    {editingDish && ( // Show visibility toggle only when editing
                                        <div className="flex items-center justify-center mb-4">
                                            <label htmlFor="dish-visibility" className="mr-3 text-teal-700 font-semibold">
                                                Visible en el Menú:
                                            </label>
                                            <input
                                                type="checkbox"
                                                id="dish-visibility"
                                                className="form-checkbox h-5 w-5 text-teal-600 rounded-md focus:ring-teal-500"
                                                checked={dishIsVisible}
                                                onChange={(e) => setDishIsVisible(e.target.checked)}
                                            />
                                        </div>
                                    )}
                                    <div className="flex gap-2">
                                        <button
                                            onClick={addOrUpdateDish}
                                            className="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105"
                                        >
                                            {editingDish ? 'Actualizar Plato' : 'Añadir Plato'}
                                        </button>
                                        {editingDish && (
                                            <button
                                                onClick={() => {
                                                    setEditingDish(null);
                                                    setDishName('');
                                                    setDishDescription('');
                                                    setDishPrice('');
                                                    setDishImageUrl('');
                                                    setDishIsVisible(true); // Reset to true for new dish
                                                }}
                                                className="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105"
                                            >
                                                Cancelar Edición
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* Export/Import Database Buttons */}
                                <div className="mb-8 p-6 bg-purple-50 rounded-lg shadow-inner">
                                    <h3 className="text-2xl font-bold text-purple-700 mb-4">Gestión de Base de Datos</h3>
                                    <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
                                        <button
                                            onClick={exportDatabase}
                                            className="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105"
                                        >
                                            Descargar Base de Datos
                                        </button>
                                        <label className="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 cursor-pointer text-center">
                                            Subir Base de Datos
                                            <input
                                                type="file"
                                                accept=".json"
                                                onChange={importDatabase}
                                                className="hidden"
                                            />
                                        </label>
                                    </div>
                                </div>

                                <h2 className="text-2xl font-bold text-teal-700 mb-4">Platos Disponibles</h2>
                                {dishes.length === 0 ? (
                                    <p className="text-center text-gray-500">No hay platos registrados. ¡Añade algunos!</p>
                                ) : (
                                    <ul className="space-y-4">
                                        {dishes.map((dish) => (
                                            <li
                                                key={dish.id}
                                                className="flex flex-col sm:flex-row items-center bg-white p-4 rounded-lg shadow-md border border-gray-200"
                                            >
                                                <img
                                                    src={dish.imageUrl}
                                                    alt={dish.name}
                                                    className="w-24 h-24 object-cover rounded-lg mr-4 mb-4 sm:mb-0"
                                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/96x96/E0F2F1/00796B?text=Plato"; }}
                                                />
                                                <div className="flex-grow text-center sm:text-left">
                                                    <p className="text-lg font-semibold text-gray-800">{dish.name}</p>
                                                    <p className="text-sm text-gray-600">{dish.description}</p>
                                                    <p className="text-md font-bold text-teal-600">${dish.price.toFixed(2)}</p>
                                                </div>
                                                <div className="flex flex-col space-y-2 mt-4 sm:mt-0 sm:ml-4">
                                                    <label className="inline-flex items-center cursor-pointer">
                                                        <input
                                                            type="checkbox"
                                                            className="sr-only peer"
                                                            checked={dish.isVisible}
                                                            onChange={() => toggleDishVisibility(dish.id, dish.isVisible)}
                                                        />
                                                        <div className="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"></div>
                                                        <span className="ml-3 text-sm font-medium text-gray-900">
                                                            {dish.isVisible ? 'Visible' : 'Oculto'}
                                                        </span>
                                                    </label>
                                                    <div className="flex space-x-2">
                                                        <button
                                                            onClick={() => startEditDish(dish)}
                                                            className="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition duration-200"
                                                            title="Editar"
                                                        >
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                            </svg>
                                                        </button>
                                                        <button
                                                            onClick={() => deleteDish(dish.id)}
                                                            className="p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition duration-200"
                                                            title="Eliminar"
                                                        >
                                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" />
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>
                        ) : (
                            // Client View
                            <div className="client-view">
                                <h2 className="text-2xl font-bold text-teal-700 mb-4">Nuestro Menú</h2>
                                {dishes.filter(dish => dish.isVisible).length === 0 ? (
                                    <p className="text-center text-gray-500">No hay platos disponibles en este momento.</p>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                                        {dishes.filter(dish => dish.isVisible).map((dish) => (
                                            <div
                                                key={dish.id}
                                                className="bg-white p-4 rounded-lg shadow-md border border-gray-200 flex flex-col items-center text-center"
                                            >
                                                <img
                                                    src={dish.imageUrl}
                                                    alt={dish.name}
                                                    className="w-32 h-32 object-cover rounded-lg mb-4"
                                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/128x128/E0F2F1/00796B?text=Plato"; }}
                                                />
                                                <h3 className="text-xl font-semibold text-gray-800 mb-1">{dish.name}</h3>
                                                <p className="text-sm text-gray-600 mb-2 flex-grow">{dish.description}</p>
                                                <p className="text-lg font-bold text-teal-600 mb-4">${dish.price.toFixed(2)}</p>
                                                <button
                                                    onClick={() => addToCart(dish)}
                                                    className="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105"
                                                >
                                                    Añadir al Carrito
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                <div className="cart-summary p-6 bg-blue-50 rounded-lg shadow-inner mt-8">
                                    <h2 className="text-2xl font-bold text-blue-700 mb-4">Tu Pedido</h2>
                                    {cart.length === 0 ? (
                                        <p className="text-center text-gray-500">El carrito está vacío.</p>
                                    ) : (
                                        <>
                                            {currentOrderId && (
                                                <p className="text-center text-lg font-semibold text-blue-800 mb-2">
                                                    ID de Pedido: <span className="font-mono">{currentOrderId}</span>
                                                </p>
                                            )}
                                            <ul className="space-y-2 mb-4">
                                                {cart.map(item => (
                                                    <li key={item.id} className="flex justify-between items-center bg-white p-3 rounded-lg shadow-sm">
                                                        <div className="flex-grow">
                                                            <span className="font-semibold text-gray-800">{item.name}</span> (x{item.quantity})
                                                        </div>
                                                        <div className="flex items-center space-x-2">
                                                            <span className="font-bold text-blue-600">${(item.price * item.quantity).toFixed(2)}</span>
                                                            <button
                                                                onClick={() => removeFromCart(item.id)}
                                                                className="p-1 rounded-full bg-red-400 text-white hover:bg-red-500 transition duration-200 text-xs"
                                                                title="Quitar uno"
                                                            >
                                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                                                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clipRule="evenodd" />
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    </li>
                                                ))}
                                            </ul>
                                            <div className="text-right text-2xl font-bold text-blue-800 mb-4">
                                                Total del Pedido: ${calculateCartTotal().toFixed(2)}
                                            </div>
                                            <button
                                                onClick={sendOrderToWhatsApp}
                                                className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center space-x-2"
                                            >
                                                <img
                                                    src="https://uploads.onecompiler.io/43hc5xg2u/43rnpuwss/Dise%C3%B1o%20sin%20t%C3%ADtulo.png"
                                                    alt="Logo de WhatsApp"
                                                    className="h-6 w-6 mr-2 object-contain"
                                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/24x24/FFFFFF/000000?text=WA"; }}
                                                />
                                                Enviar Pedido por WhatsApp
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Renderiza el componente React en el DOM
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
